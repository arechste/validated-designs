{"status":{},"contains_secrets":false,"product_version":"3.6.0","spec":{"description":"Bronze Tier, 200VMs","resources":{"client_attrs":{"NutanixMYSQLDeployment":{"y":-269.127747764,"x":-488.185398037},"None":{"y":32.8650459518,"x":-295.1696752353}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"MYSQLSvc___create___dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"MYSQLSvc___create___runbook","main_task_local_reference":{"kind":"app_task","name":"MYSQLSvc___create___dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"MYSQLSvc___start___dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"MYSQLSvc___start___runbook","main_task_local_reference":{"kind":"app_task","name":"MYSQLSvc___start___dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"MYSQLSvc___stop___dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"MYSQLSvc___stop___runbook","main_task_local_reference":{"kind":"app_task","name":"MYSQLSvc___stop___dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"MYSQLSvc___delete___dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"MYSQLSvc___delete___runbook","main_task_local_reference":{"kind":"app_task","name":"MYSQLSvc___delete___dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"MYSQLSvc___restart___dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"MYSQLSvc___restart___runbook","main_task_local_reference":{"kind":"app_task","name":"MYSQLSvc___restart___dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for deleting an application. Does not delete created VMs","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"MYSQLSvc___soft_delete___dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"MYSQLSvc___soft_delete___runbook","main_task_local_reference":{"kind":"app_task","name":"MYSQLSvc___soft_delete___dag"},"variable_list":[]},"name":"action_soft_delete"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[{"kind":"app_task","name":"Install MySQL"}],"name":"MYSQLSvc_PackageInstall_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"Install MySQL","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n#add MySQL firewall rules\nsudo systemctl disable firewalld\nsudo systemctl stop firewalld\n\n## Install MySQL packages\nsudo yum install -y --quiet \"http:\/\/repo.mysql.com\/mysql80-community-release-el7.rpm\"\nsudo yum update -y --quiet\nsudo yum install -y --quiet sshpass mysql-community-server\n\n\n## Enable and start MySQL Services\nsudo systemctl enable mysqld\nsudo systemctl start mysqld\n\n## Fix to obtain temp password and set it to blank\npassword=$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\nsudo mysqladmin --user=root --password=\"$password\" password aaBB**cc1122\nsudo mysql --user=root --password=aaBB**cc1122 -e \"UNINSTALL COMPONENT 'file:\/\/component_validate_password'\"\nsudo mysqladmin --user=root --password=\"aaBB**cc1122\" password \"\"\n\n## -*- Mysql secure installation\nmysql -u root<<-EOF\nALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY '@@{MYSQL_PASSWORD}@@';\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nDELETE FROM mysql.user WHERE User='';\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';\nFLUSH PRIVILEGES;\nEOF\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centosnutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"MYSQLSvc_PackageInstall_runbook","main_task_local_reference":{"kind":"app_task","name":"MYSQLSvc_PackageInstall_dag"},"variable_list":[]},"name":"Package Install"}],"depends_on_list":[],"name":"MYSQLSvc","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"MYSQLAHV"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"a5f82c2c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"01f7ca30_runbook","main_task_local_reference":{"kind":"app_task","name":"a5f82c2c_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"MYSQLAHV"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"eff27ccf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"10e423d7_runbook","main_task_local_reference":{"kind":"app_task","name":"eff27ccf_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"MYSQLAHV","readiness_probe":{"connection_type":"SSH","retries":"2","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"15","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"centosnutanix"}},"editables":{"readiness_probe":{"timeout_secs":true},"create_spec":{"resources":{"nic_list":{"0":{}},"serial_port_list":{},"boot_config":true}}},"os_type":"Linux","create_spec":{"name":"@@{calm_application_name}@@-@@{calm_unique}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","vpc_reference":null,"ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"vlan.0","uuid":"8434046e-fad4-4837-bcf2-02f91be79c6f"},"type":""}],"serial_port_list":[],"guest_tools":null,"type":"","num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"parent_reference":null,"memory_size_mib":4096,"power_state":"ON","hardware_clock_timezone":"","guest_customization":null,"machine_type":"Q35","account_uuid":"891153a5-b7f9-44f7-b790-c33809cce06d","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"SECURE_BOOT","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"centos7","uuid":"d183136e-1086-4404-8db9-b8c89fcb4d76"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SATA"},"device_type":"CDROM"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":{"kind":"cluster","type":"","name":"AZ01APPS02","uuid":"0005f187-92fa-57fa-47de-3cecef82f00c"},"categories":{"AZ01-DR-Bronze-02":"RPO1h","AppType":"AZ01SINGLE01","AppTier":"SSH","AZ01-Backup-01":"RPO24h"}},"variable_list":[]}],"credential_definition_list":[{"username":"nutanix","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS","cred_class":"static"},{"username":"user@domain.com","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Adcredentials","cred_class":"static"},{"username":"user@domain.com","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"prism_central","cred_class":"static"},{"username":"user_name","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"centosnutanix","cred_class":"static"}],"package_definition_list":[{"description":"","action_list":[],"type":"CUSTOM","service_local_reference_list":[{"kind":"app_service","name":"MYSQLSvc"}],"name":"LinuxVM","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[{"kind":"app_task","name":"installNgtLinux"},{"kind":"app_task","name":"AddDNS"},{"kind":"app_task","name":"DisableFirewall"},{"kind":"app_task","name":"InstallFio"},{"kind":"app_task","name":"UnmountNgt"},{"kind":"app_task","name":"AddCronEntry"}],"name":"MYSQL_PACKAGE___install___dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"installNgtLinux"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"AddDNS"}},{"from_task_reference":{"kind":"app_task","name":"AddDNS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"DisableFirewall"}},{"from_task_reference":{"kind":"app_task","name":"DisableFirewall"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"UnmountNgt"}},{"from_task_reference":{"kind":"app_task","name":"DisableFirewall"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallFio"}},{"from_task_reference":{"kind":"app_task","name":"InstallFio"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"AddCronEntry"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"installNgtLinux","attrs":{"script":"# region headers\n\"\"\"\n# escript-template v20190523 \/ stephane.bourdeaud@nutanix.com\n# * author:       stephane.bourdeaud@nutanix.com\n# * version:      2019\/06\/04\n# task_name:      PcMountNgt\n# description:    This script mounts the Nutanix Guest Tools on the AHV\n#                 virtual machine provisioned by Calm.\n\"\"\"\n# endregion\n\n# region capture Calm macros\npc_user = \"@@{prism_central.username}@@\"\npc_password = \"@@{prism_central.secret}@@\"\nvm_uuid = \"@@{platform.metadata.uuid}@@\"\ncluster_uuid = \"@@{platform.status.cluster_reference.uuid}@@\"\npc_ip = \"@@{prism_central_ip}@@\"\n# endregion\n\n# region prepare variables\ncluster_uuid_url = \"https:\/\/{}:9440\/api\/nutanix\/v3\/clusters\/{}\".format(\n    pc_ip,\n    cluster_uuid\n)\nheaders = {\n    'Accept': 'application\/json',\n    'Content-Type': 'application\/json; charset=UTF-8'\n}\n# endregion\n\n\n# region functions\nimport requests\n\ndef process_request(url, method, user, password, headers, payload=None, secure=False):\n    \"\"\"\n    Processes a web request and handles result appropriately with retries.\n    Returns the content of the web request if successfull.\n    \"\"\"\n    if payload is not None:\n        payload = json.dumps(payload)\n\n    #configuring web request behavior\n    timeout=10\n    retries = 5\n    sleep_between_retries = 5\n\n    while retries > 0:\n        try:\n\n            if method is 'GET':\n                response = requests.get(\n                    url,\n                    headers=headers,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n            elif method is 'POST':\n                response = requests.post(\n                    url,\n                    headers=headers,\n                    data=payload,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n            elif method is 'PUT':\n                response = requests.put(\n                    url,\n                    headers=headers,\n                    data=payload,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n            elif method is 'PATCH':\n                response = requests.patch(\n                    url,\n                    headers=headers,\n                    data=payload,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n            elif method is 'DELETE':\n                response = requests.delete(\n                    url,\n                    headers=headers,\n                    data=payload,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n\n        except requests.exceptions.HTTPError as error_code:\n            print (\"Http Error!\")\n            print(\"status code: {}\".format(response.status_code))\n            print(\"reason: {}\".format(response.reason))\n            print(\"text: {}\".format(response.text))\n            print(\"elapsed: {}\".format(response.elapsed))\n            print(\"headers: {}\".format(response.headers))\n            if payload is not None:\n                print(\"payload: {}\".format(payload))\n            print(json.dumps(\n                json.loads(response.content),\n                indent=4\n            ))\n            exit(response.status_code)\n        except requests.exceptions.ConnectionError as error_code:\n            print (\"Connection Error!\")\n            if retries == 1:\n                print('Error: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n                exit(1)\n            else:\n                print('Error: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n                sleep(sleep_between_retries)\n                retries -= 1\n                print (\"retries left: {}\".format(retries))\n                continue\n            print('Error: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n            exit(1)\n        except requests.exceptions.Timeout as error_code:\n            print (\"Timeout Error!\")\n            if retries == 1:\n                print('Error: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n                exit(1)\n            print('Error! Code: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n            sleep(sleep_between_retries)\n            retries -= 1\n            print (\"retries left: {}\".format(retries))\n            continue\n        except requests.exceptions.RequestException as error_code:\n            print (\"Error!\")\n            exit(response.status_code)\n        break\n\n    if response.ok:\n        return response\n    if response.status_code == 401:\n        print(\"status code: {0}\".format(response.status_code))\n        print(\"reason: {0}\".format(response.reason))\n        exit(response.status_code)\n    elif response.status_code == 500:\n        print(\"status code: {0}\".format(response.status_code))\n        print(\"reason: {0}\".format(response.reason))\n        print(\"text: {0}\".format(response.text))\n        exit(response.status_code)\n    else:\n        print(\"Request failed!\")\n        print(\"status code: {0}\".format(response.status_code))\n        print(\"reason: {0}\".format(response.reason))\n        print(\"text: {0}\".format(response.text))\n        print(\"raise_for_status: {0}\".format(response.raise_for_status()))\n        print(\"elapsed: {0}\".format(response.elapsed))\n        print(\"headers: {0}\".format(response.headers))\n        if payload is not None:\n            print(\"payload: {0}\".format(payload))\n        print(json.dumps(\n            json.loads(response.content),\n            indent=4\n        ))\n        exit(response.status_code)\n      \n# endregion\n\n# region get the AHV cluster IP address\nmethod = 'GET'\nurl = cluster_uuid_url\nprint(\"Retrieving cluster IP address...\")\nprint(\"Making a {} API call to {}\".format(method, url))\nresp = process_request(url, method, pc_user, pc_password, headers)\n\nif resp.ok:\n    result = json.loads(resp.content)\n    # print the content of the response\n    print(json.dumps(\n        json.loads(resp.content),\n        indent=4\n    ))\n    cluster_ip = result[\"status\"][\"resources\"][\"network\"][\"external_ip\"]\n    print(\"The AHV cluster IP address is {}\".format(cluster_ip))\nelse:\n    exit(1)\n# endregion\n\n# region mount the NGT image (to regenerate the certificates)\nmethod = 'POST'\nurl = \"https:\/\/{}:9440\/PrismGateway\/services\/rest\/v1\/vms\/{}\/guest_tools\/mount\".format(\n    cluster_ip,\n    vm_uuid\n)\nprint(\"Mounting NGT...\")\nprint(\"Making a {} API call to {}\".format(method, url))\nresp = process_request(url, method, pc_user, pc_password, headers)\nresult = json.loads(resp.content)\n\nif resp.ok:\n    # print the content of the response\n    print(json.dumps(\n        json.loads(resp.content),\n        indent=4\n    ))\n    print(\"NGT mounted\")\n    exit(0)\nelse:\n    exit(1)\n# endregion","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","exec_target_reference":{"kind":"app_endpoint","name":"AZ01AD01"},"inherit_target":false,"child_tasks_local_reference_list":[],"name":"AddDNS","attrs":{"exit_status":[],"script":"Add-DnsServerResourceRecordA -Name \"@@{name}@@\" -ZoneName \"@@{domain_name}@@\" -AllowUpdateAny -CreatePtr -IPv4Address \"@@{address}@@\" -TimeToLive 01:00:00","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Adcredentials"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"DisableFirewall","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nsudo systemctl disable firewalld\nsudo systemctl stop firewalld","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centosnutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"InstallFio","attrs":{"exit_status":[],"script":"sudo yum makecache\nsudo yum -y install fio","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centosnutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"UnmountNgt","attrs":{"script":"# region headers\n\"\"\"\n# escript-template v20190523 \/ stephane.bourdeaud@nutanix.com\n# * author:       stephane.bourdeaud@nutanix.com\n# * version:      2019\/06\/04\n# task_name:      PcMountNgt\n# description:    This script mounts the Nutanix Guest Tools on the AHV\n#                 virtual machine provisioned by Calm.\n\"\"\"\n# endregion\nsleep(60)\n# region capture Calm macros\npc_user = \"@@{prism_central.username}@@\"\npc_password = \"@@{prism_central.secret}@@\"\nvm_uuid = \"@@{platform.metadata.uuid}@@\"\ncluster_uuid = \"@@{platform.status.cluster_reference.uuid}@@\"\npc_ip = \"@@{prism_central_ip}@@\"\n# endregion\n\n# region prepare variables\ncluster_uuid_url = \"https:\/\/{}:9440\/api\/nutanix\/v3\/clusters\/{}\".format(\n    pc_ip,\n    cluster_uuid\n)\nheaders = {\n    'Accept': 'application\/json',\n    'Content-Type': 'application\/json; charset=UTF-8'\n}\n# endregion\n\n\n# region functions\nimport requests\n\ndef process_request(url, method, user, password, headers, payload=None, secure=False):\n    \"\"\"\n    Processes a web request and handles result appropriately with retries.\n    Returns the content of the web request if successfull.\n    \"\"\"\n    if payload is not None:\n        payload = json.dumps(payload)\n\n    #configuring web request behavior\n    timeout=10\n    retries = 5\n    sleep_between_retries = 5\n\n    while retries > 0:\n        try:\n\n            if method is 'GET':\n                response = requests.get(\n                    url,\n                    headers=headers,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n            elif method is 'POST':\n                response = requests.post(\n                    url,\n                    headers=headers,\n                    data=payload,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n            elif method is 'PUT':\n                response = requests.put(\n                    url,\n                    headers=headers,\n                    data=payload,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n            elif method is 'PATCH':\n                response = requests.patch(\n                    url,\n                    headers=headers,\n                    data=payload,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n            elif method is 'DELETE':\n                response = requests.delete(\n                    url,\n                    headers=headers,\n                    data=payload,\n                    auth=(user, password),\n                    verify=secure,\n                    timeout=timeout\n                )\n\n        except requests.exceptions.HTTPError as error_code:\n            print (\"Http Error!\")\n            print(\"status code: {}\".format(response.status_code))\n            print(\"reason: {}\".format(response.reason))\n            print(\"text: {}\".format(response.text))\n            print(\"elapsed: {}\".format(response.elapsed))\n            print(\"headers: {}\".format(response.headers))\n            if payload is not None:\n                print(\"payload: {}\".format(payload))\n            print(json.dumps(\n                json.loads(response.content),\n                indent=4\n            ))\n            exit(response.status_code)\n        except requests.exceptions.ConnectionError as error_code:\n            print (\"Connection Error!\")\n            if retries == 1:\n                print('Error: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n                exit(1)\n            else:\n                print('Error: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n                sleep(sleep_between_retries)\n                retries -= 1\n                print (\"retries left: {}\".format(retries))\n                continue\n            print('Error: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n            exit(1)\n        except requests.exceptions.Timeout as error_code:\n            print (\"Timeout Error!\")\n            if retries == 1:\n                print('Error: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n                exit(1)\n            print('Error! Code: {c}, Message: {m}'.format(c = type(error_code).__name__, m = str(error_code)))\n            sleep(sleep_between_retries)\n            retries -= 1\n            print (\"retries left: {}\".format(retries))\n            continue\n        except requests.exceptions.RequestException as error_code:\n            print (\"Error!\")\n            exit(response.status_code)\n        break\n\n    if response.ok:\n        return response\n    if response.status_code == 401:\n        print(\"status code: {0}\".format(response.status_code))\n        print(\"reason: {0}\".format(response.reason))\n        exit(response.status_code)\n    elif response.status_code == 500:\n        print(\"status code: {0}\".format(response.status_code))\n        print(\"reason: {0}\".format(response.reason))\n        print(\"text: {0}\".format(response.text))\n        exit(response.status_code)\n    else:\n        print(\"Request failed!\")\n        print(\"status code: {0}\".format(response.status_code))\n        print(\"reason: {0}\".format(response.reason))\n        print(\"text: {0}\".format(response.text))\n        print(\"raise_for_status: {0}\".format(response.raise_for_status()))\n        print(\"elapsed: {0}\".format(response.elapsed))\n        print(\"headers: {0}\".format(response.headers))\n        if payload is not None:\n            print(\"payload: {0}\".format(payload))\n        print(json.dumps(\n            json.loads(response.content),\n            indent=4\n        ))\n        exit(response.status_code)\n      \n# endregion\n\n# region get the AHV cluster IP address\nmethod = 'GET'\nurl = cluster_uuid_url\nprint(\"Retrieving cluster IP address...\")\nprint(\"Making a {} API call to {}\".format(method, url))\nresp = process_request(url, method, pc_user, pc_password, headers)\n\nif resp.ok:\n    result = json.loads(resp.content)\n    # print the content of the response\n    print(json.dumps(\n        json.loads(resp.content),\n        indent=4\n    ))\n    cluster_ip = result[\"status\"][\"resources\"][\"network\"][\"external_ip\"]\n    print(\"The AHV cluster IP address is {}\".format(cluster_ip))\nelse:\n    exit(1)\n# endregion\n\n# region mount the NGT image (to regenerate the certificates)\nmethod = 'POST'\nurl = \"https:\/\/{}:9440\/PrismGateway\/services\/rest\/v1\/vms\/{}\/guest_tools\/unmount\".format(\n    cluster_ip,\n    vm_uuid\n)\nprint(\"Unmounting NGT...\")\nprint(\"Making a {} API call to {}\".format(method, url))\nresp = process_request(url, method, pc_user, pc_password, headers)\nresult = json.loads(resp.content)\n\nif resp.ok:\n    # print the content of the response\n    print(json.dumps(\n        json.loads(resp.content),\n        indent=4\n    ))\n    print(\"NGT Unmounted\")\n    exit(0)\nelse:\n    exit(1)\n# endregion","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"AddCronEntry","attrs":{"exit_status":[],"script":"echo \"*\/2 * * * *  fio --name=global --rw=randrw --ioengine=libaio --size=1g --bs=8k --name=job1 --time_based --runtime=120 --rate_iops=25,7\" | crontab","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centosnutanix"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"MYSQL_PACKAGE___install___runbook","main_task_local_reference":{"kind":"app_task","name":"MYSQL_PACKAGE___install___dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[{"kind":"app_task","name":"RemoveDnsEntry"}],"name":"DAG_Task_for_Package_MYSQL_PACKAGE_action_uninstall","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","exec_target_reference":{"kind":"app_endpoint","name":"AZ01AD01"},"inherit_target":false,"child_tasks_local_reference_list":[],"name":"RemoveDnsEntry","attrs":{"exit_status":[],"script":"Remove-DnsServerResourceRecord -ZoneName \"nvd.local\" -RRType \"A\" -Name \"@@{name}@@\" -RecordData \"@@{address}@@\" -Force","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Adcredentials"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"Runbook_for_Package_MYSQL_PACKAGE_action_uninstall","main_task_local_reference":{"kind":"app_task","name":"DAG_Task_for_Package_MYSQL_PACKAGE_action_uninstall"},"variable_list":[]},"upgrade_runbook":{}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"AHV_CENTOS_78","version":"","options":{"type":"","name":"CENTOS_78","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/Calm\/CentOS-7-x86_64-2003.qcow2","version":{"product_version":"1.0","type":"","product_name":"AHV_CENTOS_78"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"ESX_CENTOS_78","version":"","options":{"type":"","name":"CENTOS_78","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/Calm\/CentOS-7-x86_64-2003.ova","version":{"product_version":"1.0","type":"","product_name":"ESX_CENTOS_78"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"NutanixMYSQLDeployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"LinuxVM"}],"substrate_local_reference":{"kind":"app_substrate","name":"MYSQLAHV"},"options":{"type":""},"variable_list":[],"description":""}],"environment_reference_list":[],"application_url":"","description":"","action_list":[{"description":"This action will scale out App Server slaves by given scale out count.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"Nutanix_ScaleOut_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"Nutanix_ScaleOut_runbook","main_task_local_reference":{"kind":"app_task","name":"Nutanix_ScaleOut_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COUNT","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"ScaleOut"},{"description":"This action will scale in App Server slaves by given scale in count.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"Nutanix_ScaleIn_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"Nutanix_ScaleIn_runbook","main_task_local_reference":{"kind":"app_task","name":"Nutanix_ScaleIn_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COUNT","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"ScaleIn"},{"description":"This action will take mysql backup.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[{"kind":"app_task","name":"Do DB Backup"}],"name":"Nutanix_DBBackup_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"Do DB Backup","attrs":{"script":"#!\/bin\/bash\n\n### Setup variables\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\ndate_part=`date +%F`\nmkdir -p @@{BACKUP_FILE_PATH}@@\nsudo mysqldump -u root -p${mysql_password} --all-databases | sudo gzip -9 > @@{BACKUP_FILE_PATH}@@\/db_dump.sql.gz","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"Nutanix_DBBackup_runbook","main_task_local_reference":{"kind":"app_task","name":"Nutanix_DBBackup_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"BACKUP_FILE_PATH","value":"~\/db_backup","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"DBBackup"},{"description":"This action will restore mysql db from specified file.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[{"kind":"app_task","name":"Do DB Restore"}],"name":"Nutanix_DBRestore_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQLSvc"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"Do DB Restore","attrs":{"script":"#!\/bin\/bash\n\n### Setup variables\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\ndb_file=@@{RESTORE_FILE_PATH}@@\n\nsudo gunzip < $db_file | sudo mysql -u root -p${mysql_password} ","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"Nutanix_DBRestore_runbook","main_task_local_reference":{"kind":"app_task","name":"Nutanix_DBRestore_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"RESTORE_FILE_PATH","value":"~\/db_backup\/db_dump.sql.gz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"DBRestore"}],"name":"Nutanix","restore_config_list":[],"snapshot_config_list":[],"patch_list":[],"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_PASSWORD","value":"nutanix\/4u","label":"","attrs":{"type":"LOCAL"},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"domain_name","value":"<provide_domain_name>","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"prism_central_ip","value":"<provide IP address>","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"CentOS7-public"},"api_version":"3.0","metadata":{"last_update_time":"1676313403814484","kind":"blueprint","spec_version":1,"creation_time":"1676313275450743","categories":{"AppFamily":"DevOps"},"name":"CentOS7-public"}}